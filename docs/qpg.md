# Testing Database Engines via Query Plan Guidance (QPG)

## 问题背景
随机 SQL fuzzing 容易重复生成“计划形状相似”的查询，导致覆盖停滞。即使生成大量查询，也很难触达优化器的关键分支与边界路径。

## 核心思路
QPG 将“执行计划形状”作为覆盖指标，利用 EXPLAIN 抽取计划特征，动态调整查询生成策略，使 fuzzing 更倾向于探索尚未覆盖或覆盖不足的计划形状。

## 关键机制
1. 对生成的查询执行 EXPLAIN，提取计划节点序列、算子类型、连接顺序等特征。
2. 维护“已见计划形状”的缓存与频次统计，度量覆盖停滞。
3. 当覆盖增长停滞时，提升生成特定结构（如 JOIN、聚合、子查询）的概率，驱动探索新的优化路径。

## Oracle 形态
QPG 本身不提供“正确性 oracle”，而是“覆盖驱动器”。它通过引导生成器偏向稀缺计划形状，提高逻辑错误或性能问题被其他 oracle 捕获的概率。

## 适用范围与限制
- 需要 EXPLAIN 输出可稳定解析，并具备一定的结构差异性。
- 过强的引导可能导致生成空间偏置，需要与随机探索平衡。
- 对于计划缓存、参数化查询等模式需额外处理，以免计划采样误导。

## 价值与影响
QPG 将传统的“输入多样性”提升为“计划多样性”，显著提高 fuzzing 对优化器分支覆盖的能力，是提升整体 oracle 命中率的关键补充。
