# Shiro Fuzz Tool - Agent Notes

Project notes are now documented under `docs/notes/` with supporting references below.

Links:
- [Notes Summary](docs/notes/summary.md)
- [Experience Notes](docs/notes/experience.md)
- [Feature Notes](docs/notes/feature.md)
- [Follow-ups](docs/notes/follow-ups.md)
- [Roadmap](docs/roadmap.md)
- [PQS Notes](docs/pqs.md)
- [Argus Notes](docs/argus.md)
- [Oracles](docs/oracles/README.md)
- [Glossary](docs/glossary.md)
- [Architecture Decisions](docs/decisions/README.md)

## Workflow guardrails

- After each task completes, review and update `AGENTS.md` and `docs/todo.md`, removing completed items and syncing current progress.
- Documentation must be written in English.
- When updating TiDB issues, collapse large SQL blocks (apply schema/load data) in `<details>` and format the "Run the query" SQL for readability.

## Recent updates

- Reviewed a fresh local run (`logs/shiro.log`, `reports/case_0001..0003`): DQP had no `sql_error_1054` and kept effective ratio 1.0; EET `no_transform` skip dropped to ~10% in DQE interval, but GroundTruth remained skip-dominated (`dsg_key_mismatch_right_key`/`base_table`) with effective ratio 0; captured cases were EET/PQS missing-column errors and all were minimize non-reproducible (`base_replay_not_reproducible`) (2026-02-14).
- Implemented logs/reports follow-ups: GroundTruth now performs DSG prechecks (base/join key safety) plus right-key availability validation and uses higher pick retries; EET now falls back across rewrite kinds to reduce `eet:no_transform`; DQP now skips invalid-scope queries with `dqp:scope_invalid`; added regression tests (including NATURAL RIGHT JOIN qualified-column scope) and ran `go test ./internal/...` (2026-02-14).
- Reviewed local logs/reports sample (`logs/shiro.log` + 4 `reports/case_*/summary.json`): GroundTruth skips were dominated by `dsg_key_mismatch_right_key`/`empty_query`, EET skips were dominated by `eet:no_transform`, and 3/4 captured cases were `minimize_status=skipped` with `minimize_reason=base_replay_not_reproducible`; added targeted follow-up actions in `docs/todo.md` (2026-02-14).
- Addressed PR #110 follow-up review findings: hardened case summary path component sanitization against dot-segment traversal, made index `summary_url` prefer local `cases/<case_id>/summary.json` when case IDs exist (fallback to HTTP report URL only when no case ID), and aligned frontend inferred detail-loaded checks to treat empty `details` objects as not loaded (2026-02-13).
- Addressed PR #110 review threads: aligned frontend/backend search-blob empty-details handling, added abort/race guards for on-demand case detail fetches, and marked index entries without resolvable summary sources as `detail_loaded=true` to avoid broken lazy fetch attempts (2026-02-13).
- Completed report index + on-demand detail loading (P1): `cmd/shiro-report` now emits `reports.index.json` plus per-case `cases/<case_id>/summary.json`, publish flow includes all summary JSON files, and the report UI now loads `reports.index.json` first with lazy `summary_url` fetch on case expand (fallback to `reports.json`/`report.json` preserved) (2026-02-13).
- Addressed PR #109 review follow-ups in report UI: simplified `caseRenderKey`, cleaned search-blob construction to avoid null-detail noise, fixed disabled button hover behavior, and added pagination `aria-label`s for accessibility (2026-02-13).
- Improved report UI query efficiency (P0): added debounced + deferred keyword search, prebuilt per-case search blobs to avoid repeated string assembly during filtering, introduced client-side pagination (30 cases/page), and lazily rendered heavy case body blocks only after row expansion (2026-02-13).
- Addressed PR #108 review follow-ups in report UI metadata bootstrap: handled bootstrap promise errors safely, avoided marking missing cases as loaded on incomplete paging, preserved in-progress modal drafts during bootstrap merges, narrowed bootstrap effect dependencies with refs, and aligned PATCH auth header construction with shared helper (2026-02-13).
- Fixed report UI metadata persistence after refresh: page load now bootstraps case metadata from Worker `/api/v1/cases` (with auth header when token is set) so saved tags/issues remain visible after reload; similar-case API requests now also include the same auth header (2026-02-13).
- Fixed Cloudflare Git deploy config drift: root `wrangler.jsonc` now includes the Worker `DB` D1 binding, worker-local `wrangler.jsonc` binding is aligned to `DB`, and README documents that root config must include runtime bindings to avoid deploy-time binding loss (2026-02-13).
- Hardened logs/reports diagnostics: PQS now records pivot/containment error stages + SQL, deduplicates `USING(id)` projections to avoid ambiguous/missing-column failures, EET classifies runtime DISTINCT+ORDER BY (`3065`) as skip, and runner startup recovers stale `minimize_status=in_progress` summaries to `interrupted` with tests (2026-02-12).
- Added Worker-side 500 logging with request_id for easier troubleshooting (2026-02-12).
- Allowed tag/issue saves even when metadata was not preloaded (2026-02-12).
- Treat metadata 404 as empty meta in the UI so empty queries do not surface errors (2026-02-12).
- Secured worker list/search/similar endpoints behind read auth and documented metadata-only similarity/search behavior (2026-02-12).
- Enabled top-level worker observability flag to match nested log settings (2026-02-12).
- Slimmed the Worker D1 schema to store only case_id/labels/linked_issue and simplified sync/list/similar logic to metadata-only (2026-02-12).
- Dropped the Worker download endpoint and switched UI downloads to use report archive URLs directly (2026-02-12).
- Embedded the report UI into the Worker assets pipeline with a build:worker export flow and same-origin fallback (2026-02-12).
- Disabled Turbopack for build:worker to avoid font loader resolution failures in Worker builds (2026-02-12).
- Added tag/issue toggles with issue-link rendering in the report UI (2026-02-12).
- Added preset label chips plus label-based filtering support in the report UI (2026-02-12).
- Switched tag/issue editing to a modal with add/remove presets and issue linking (2026-02-12).
- Enabled modal dismissal via Escape key and backdrop click (2026-02-12).
- Added Cloudflare Worker observability settings to wrangler.jsonc (2026-02-12).
- Ignored local Cloudflare worker dev artifacts, plus added wrangler devDependency for worker tooling (2026-02-12).
- Synced web package-lock for wrangler devDependency to keep npm ci green (2026-02-12).
- Secured case-metadata GET behind API token when configured, narrowed metadata payloads, and store write tokens in session storage (2026-02-12).
- Removed the waterfall view selector from the report UI (2026-02-11).
- Moved worker write-token input from Filters to a Settings panel in the report UI (2026-02-11).
- Cloudflare Worker now exposes per-case metadata and report UI supports tagging/issue linking via token-authenticated PATCH (2026-02-11).
- Report UI orders case detail sections as error, schema.sql, data.tsv, then case.sql (2026-02-11).
- Report UI now hides Expected/Actual blocks independently when their text is empty (2026-02-11).
- Report UI hides the Open report.json action and keeps report.json folded by default (2026-02-11).
- Report UI now maps `gs://` artifact locations to public GCS URLs for downloads (2026-02-11).
- Report UI hides `case.tar.zst` content and presents a single download-case action per bug (2026-02-11).
- Simplified USING ambiguity checks to reuse a single left-side column collection pass (2026-02-11).
- Guarded USING joins against ambiguous left-side columns by considering all left-table columns, with generator regression coverage (2026-02-11).
- Fixed PQS USING-id select qualification, enriched case logs with case_id/error_reason/minimize fields, and stabilized QPG delta logging with reset flags (2026-02-11).
- Clarified recursive CTE feature semantics and refactored generator interval log format strings for readability (2026-02-11).
- Added `config.example.yaml` and switched tests to load it instead of `config.yaml` to avoid local-only config dependencies (2026-02-11).
- Added generator feature counters and interval logs for natural joins, full join emulation, and recursive CTEs, plus regression coverage (2026-02-11).
- Added GCS artifact storage support with gs:// URL mapping while keeping R2 publish flow and legacy S3 compatibility (2026-02-10).
- Added a Cloudflare Worker assets stub plus wrangler config to satisfy Git-integrated deploy requirements (2026-02-10).
- Added a repo-root `wrangler.jsonc` so `wrangler versions upload` can find the worker entrypoint and assets (2026-02-10).
- Added PQS v2/v3 support: join-aware `JOIN ON` predicates with rectification metadata, subquery predicates (`EXISTS`/`IN`/`ANY`/`ALL`), derived-table wrapping, and tests plus updated PQS docs/TODOs (2026-02-09).
- Added DQP SET_VAR hints for tidb_enable_outer_join_reorder and tidb_enable_inl_join_inner_multi_pattern (2026-02-09).
- Ensured PQS pivot row fetch checks rows.Err and uses CloseWithErr to avoid masking query failures (2026-02-09).
- Stripped database qualifiers from dumped CREATE VIEW statements in reports, with normalizeCreateView tests (2026-02-09).
- Deduplicated CODDTest CASE conditions to reduce oversized dependent predicates, with regression coverage (2026-02-09).
- Guarded NATURAL JOIN generation when left-side duplicate column names would cause ambiguity, with generator regression coverage (2026-02-09).
- Addressed PQS review feedback (bool literal consistency, row error checks, preallocations, doc status updates) (2026-02-09).
- Fixed PQS lints by handling `rows.Close()` errors and naming multi-value returns flagged by revive (2026-02-09).
- Skipped float/double columns when building PQS predicates to avoid exact-float false positives (2026-02-09).
- Added a PQS predicate-strategy bandit (rectify-random vs pivot-single/multi) with bandit metadata and predicate-range tests (2026-02-09).
- Added a minimal PQS 3VL evaluator/rectifier with predicate rectification metadata and fallback reasons (2026-02-08).
- Optimized PQS containment queries to match only `id` columns when available, reducing SQL size (2026-02-08).
- Reviewed a PQS-focused run: 20 PQS cases (18 join, 1 single-table, 1 error), with one TiDB runtime error (`Error 1105: index out of range`) that was non-reproducible in minimize (2026-02-09).
- Added a PQS join containment SQL integration test for basic two-table pivots (2026-02-08).
- Cleaned `docs/roadmap.md` completed items, reorganized the roadmap by stages, and synced `docs/todo.md` with `docs/notes/follow-ups.md` (2026-02-08).
- Moved completed Impo roadmap items out of TODO tracking and recorded them in feature notes (2026-02-08).
- Enhanced PQS pivot sampling with `id`-range selection (avoids `ORDER BY RAND()`), added basic two-table `JOIN ... USING (id)` pivots with alias-aware matching, switched containment checks to `LIMIT 1` existence probes, and enabled a default PQS oracle weight (2026-02-08).
- Added PQS v1 oracle (single-table pivot selection, equality/IS NULL predicates, containment check), wired weights/overrides/config, and expanded unit tests (2026-02-08).
- Updated the remaining report diff viewer `compareMethod` usage to the `DiffMethod.WORDS_WITH_SPACE` enum to satisfy Next.js type checks (2026-02-09).
- Switched the report diff viewer `compareMethod` to use the `DiffMethod.WORDS_WITH_SPACE` enum for type-safe Next.js builds (2026-02-09).
- Replaced the `JSX.Element` type alias in the report page with `ReactNode` to avoid missing JSX namespace errors during Next.js builds (2026-02-09).
- Hardened compute worker webpack replacement plugin resolution so CI tests do not fail when `NormalModuleReplacementPlugin` is missing from the bundled webpack export (2026-02-09).
- Configured Next.js alias/extension alias to map `computeWorker.ts` to the shipped `computeWorker.js` and updated the worker verification test for the web report build (2026-02-09).
- Guarded `next build` behind a release flag so local defaults use `next dev`, and added a `build:release` script for optimized builds (2026-02-09).
- Switched the default `next dev` script to `--turbo` and added `dev:webpack` for a webpack fallback (2026-02-09).
- Vendored `react-diff-viewer-continued` compute worker implementation to break the worker/compute-lines import cycle while keeping Worker execution, and aliased Next.js to the local compute-lines module (2026-02-09).
- CI now verifies the web worker alias config and runs a release web build via `SHIRO_RELEASE=1` to exercise the optimized build path (2026-02-09).
- Next config now loads webpack via Next's bundled webpack fallback to keep the worker config test runnable in CI (2026-02-09).
- Turbopack aliases now include relative compute-lines/computeWorker specifiers to avoid resolution failures when the diff viewer uses relative worker imports (2026-02-09).
- Documented web worker override upgrade guidance in `docs/notes/feature.md` (2026-02-09).
- Adjusted flaky errno test to use non-fatal assertions (2026-02-09).
- Fixed lint follow-ups: `cmd/shiro-report` now closes worker sync HTTP response bodies via `resp.Body.Close()` (for `bodyclose`) and `internal/report` now documents exported case-archive constants (`CaseArchiveName`/`CaseArchiveCodec`) to satisfy `revive` (2026-02-08).
- Addressed PR #78 review findings: Worker now defaults writes to deny without token (optional `ALLOW_INSECURE_WRITES` for local dev), enforces request body/sync-case limits, adds `Vary: Origin`, fixes PATCH empty-payload semantics, normalizes download/report/archive URLs to HTTP(S), hardens AI prompt user-input delimiters, and updates shiro-report with `-artifact-public-base-url`, worker sync timeout/error handling, and S3 listing-based sidecar detection; frontend now hides non-HTTP(S) artifact links (2026-02-07).
- CI: added a dedicated frontend pipeline job in `.github/workflows/ci.yaml` that runs web compile (`tsc --noEmit`), lint, and tests; backend/integration job now depends on the web job (2026-02-06).
- Added `web/lib/report-utils.ts` and unit tests (`web/test/report-utils.test.ts`) to cover report URL/case-id/worker-link derivation used by the frontend (2026-02-06).
- Added Cloudflare metadata plane skeleton under `web/cloudflare-worker/` with D1 schema, sync/list/patch/download APIs, and per-case similar-bug endpoint (`/api/v1/cases/:case_id/similar`) with optional AI summary (2026-02-06).
- Extended `cmd/shiro-report` with optional manifest publish flags (R2/S3-compatible) and optional Worker metadata sync callback; default behavior remains unchanged when flags are omitted (2026-02-06).
- Updated web report UI without changing core layout: added optional in-page similar-bug panel, Worker-backed archive download path, and `reports.json` fallback loading improvements (2026-02-06).
- Added compatibility guardrail: when `storage.s3.enabled=false`, keep legacy local reporting flow (`case_XXXX_uuid` directories and summary-only artifacts); enable UUID-as-path, per-case `report.json`, and `case.tar.zst` only in S3 cloud mode (2026-02-06).
- Updated report frontend to load `reports.json` with fallback to `report.json`, added waterfall/list view toggle, and added per-case archive/report download links (2026-02-06).
- Completed P1-P4 for fuzz cloud reporting baseline: switched case directories to UUIDv7 IDs, aligned runner/report/shiro-report `case_id`, generated per-case `report.json` plus `case.tar.zst`, uploaded S3 paths as `s3://<bucket>/<uuid>/...`, and made `cmd/shiro-report` emit both `report.json` and `reports.json` with archive/report URLs in entries (2026-02-06).
- Created branch `feat/fuzz-display-query-capability` in dedicated worktree for fuzz display/query capability enhancement; currently in requirements phase before implementation (2026-02-06).
- Captured requirements: use UUIDv7 as canonical bug id across runner/report/frontend, upload artifacts under `s3://<bucket>/<uuid>/`, push report manifests to Cloudflare for search, and support frontend archive download per case with Cloudflare Worker+D1+AI search infra (2026-02-06).
- Chosen cloud split for this project: case artifacts remain in S3, aggregated `reports.json` is published to Cloudflare R2, and metadata/tagging/search APIs run on Cloudflare Workers + D1 + AI search (2026-02-06).
- Refined profile constraint application to avoid relaxing subquery bans; simplified CERT/CODDTest builder setup; added override/profile regression tests (2026-02-08).
- NoREC profile now disables set operations; added profile-constraint mapping tests and SelectQueryBuilder analysis refresh regression coverage (2026-02-08).
- Renamed oracle profile types/helpers to avoid revive stutter warnings (2026-02-08).
- QuerySpec now accepts oracle profiles so generator constraints can be derived from the same capability gating used by runtime overrides (2026-02-08).
- Centralized query analysis reuse in SelectQueryBuilder to avoid redundant AST walks while keeping determinism checks accurate (2026-02-08).
- Replaced hard-coded oracle overrides with data-driven profiles for easier tuning and more consistent capability gating (2026-02-08).
- Centralized minimizer default rounds into a shared constant to avoid divergent defaults across reducers (2026-02-08).
- Documented sqlSliceWeight scaling intent via a named constant to keep statement count dominant (2026-02-08).
- Fixed revive lint by naming minimizer helper return values and removing an unused test parameter (2026-02-08).
- SelectQueryBuilder now invalidates cached analysis after attaching predicates so determinism checks stay accurate (2026-02-08).
- Minimize pipeline was deeply refactored with strategy-based reduction (`case_error` vs replay-spec), multi-pass convergence (insert/case/spec alternating), validated insert-merge adoption, and weighted-candidate selection to avoid non-improving rewrites; added focused runner tests for merge validation, set-var dropping, and alternating reduction (2026-02-08).
- Impo seed-query guardrail skips now retain the last concrete failure reason (`seed_guardrail:<reason>`), and minimize now runs a mandatory base-replay precheck: non-reproducible cases are marked `minimize_status=skipped` plus top-level `flaky=true` with `minimize_reason`/`flaky_reason=base_replay_not_reproducible`; added regression tests (2026-02-07).
- GroundTruth now rewrites `USING` joins to explicit `ON` predicates before edge extraction/execution to avoid ambiguous `USING` resolution on multi-table left factors; EET adds stronger pre-guards (`scope_invalid`, DISTINCT+ORDER BY compatibility) and scope validation now treats NATURAL joins like USING for qualified-column visibility; report summaries switch minimize status flow to `in_progress/success/skipped/interrupted` with deferred interrupted fallback (2026-02-07).
- Reduced oracle skip noise by adding QuerySpec `MaxTries` for constrained builders (TLP/DQP/NoREC/EET), disallowing TLP set operations at build-time, retrying GroundTruth candidate picking across empty/guardrail/edge-mismatch cases, and retrying Impo seed-query selection before skip; added TLP set-op skip regression test (2026-02-07).
- Report capture now logs early case allocation and persists top-level `minimize_status` in `summary.json` (`disabled` / `not_applicable` / `in_progress` / `success` / `skipped` / `interrupted`) for better logs/reports consistency (2026-02-07).
- Fixed remaining PR-77 review items: render base/join aliases for non-derived table factors (generator/oracle SQL builders), enforce nested-query scope validation with resolver-backed table columns (including strict empty-column-set checks), and make FULL JOIN emulation use unqualified USING anti-filters to satisfy scope rules; added regression tests (2026-02-07).
- Removed two `ineffassign` findings by deleting an unused `lastKeyReason` assignment in GroundTruth query picking and simplifying DSG mismatch label initialization in runner stats (2026-02-07).
- Report metadata now surfaces `groundtruth_dsg_mismatch_reason` at summary/index top level (runner summary write + shiro-report case entry), with runner tests covering detail/skip-reason extraction (2026-02-07).
- Added top-level interval aggregation for `groundtruth_dsg_mismatch_reason` from GroundTruth skip deltas and covered the parser/aggregation with runner unit tests (2026-02-07).
- Added GroundTruth DSG mismatch reason taxonomy with retry-on-mismatch query picking, moved CODDTest null/type guards into build-time prechecks to reduce runtime skips, and added shared EET/TLP signature prechecks for invalid ORDER BY ordinals and known-table column visibility; added regression tests (2026-02-07).
- Systematically fixed PR-77 follow-ups: normalized set-operation ORDER/LIMIT handling to avoid branch-only binding, unified inline-subquery `WITH` guardrails across scalar/EXISTS/quantified expressions, and aligned runner `bug_hint` to `tidb:plan_reference_missing`; added regression tests (2026-02-07).
- Scope manager now enforces `USING` column visibility for qualified references in query-body clauses (SELECT/WHERE/GROUP/HAVING/WINDOW/ORDER), with regression tests for hidden/common columns and preserved non-USING columns (2026-02-07).
- Systematically tightened NoREC query constraints by adding builder-level `DisallowSetOps`, refactoring shared constraint evaluation in `SelectQueryBuilder`, moving NoREC guardrails into `QueryGuardReason` (set-op / limit-without-order / predicate-subquery), and adding regression tests for constraint reasons and NoREC guard behavior (2026-02-07).
- P1 skip-reduction batch 1: tightened GroundTruth/CODDTest oracle overrides (disable views/derived/set-op/subquery-heavy features per oracle), switched CODDTest predicate mode to simple-columns, and widened CODDTest type guard to all supported scalar column types; added runner/oracle tests (2026-02-07).
- Added shared runner-side result annotation to classify `error_reason`/`bug_hint` (including PlanCache error paths) and tagged GroundTruth mismatches as `groundtruth:count_mismatch`; added runner unit tests for reason/hint mapping (2026-02-07).
- Disabled `INTERSECT ALL` generation for TiDB compatibility (matching existing `EXCEPT ALL` disablement) and added a regression test to ensure both stay non-ALL (2026-02-07).
- Hardened expression determinism/build paths against nil operands in `UnaryExpr`/`BinaryExpr`, and added regression coverage for nil binary operands to prevent `QueryDeterministic` panic (2026-02-07).
- Simplified `EXCEPT ALL` gating to the default non-ALL path and added a regression test to ensure `EXCEPT ALL` is never generated for TiDB compatibility (2026-02-07).
- Added broader SQL2023-focused tests: recursive CTE numeric guard, FULL JOIN emulation key-selection edge cases, named-window override rendering, grouping ordinal unwrap, window-def determinism, and oracle SQL helper fast-path/build coverage (2026-02-07).
- Added SQL2023-oriented generation features: NATURAL JOIN, FULL JOIN semantic emulation (`LEFT/RIGHT + UNION ALL`), recursive CTE (`WITH RECURSIVE`), window frame + named WINDOW clauses, GROUP BY WITH ROLLUP (+ GROUPING item), and INTERVAL arithmetic; added generator/oracle compatibility updates and tests (2026-02-06).
- Added `docs/argus.md` from paper `2510.06663v1` (Argus): CAQ-based oracle discovery with solver-backed verification and snippet-corpus instantiation flow (2026-02-06).
- Read OSDI20 Rigger and added `docs/pqs.md` with a staged PQS integration outline; synced TODO/follow-ups with actionable PQS tasks (2026-02-06).
- Fixed set-op scope visibility (operand tables no longer leak into main-query scope), enabled derived-table generation in template FROM paths, and made SubqueryExpr/ExistsExpr determinism checks recurse into subqueries; added regression tests (2026-02-06).
- Added feature-flagged SQL capability groundwork for set operations (`UNION/INTERSECT/EXCEPT`), derived tables (`FROM/JOIN (subquery) AS alias`), and quantified subqueries (`ANY/SOME/ALL`), plus recursive query-analysis/oracle helper coverage and tests (2026-02-06).
- Fixed `sqlErrorReason(nil)` to return an empty reason and added a regression test; clarified EET ORDER BY drop semantics with inline comments (2026-02-06).
- Added error_reason classification for DQP/NoREC, surfaced error_reason/bug_hint/error_sql/replay_sql in summaries, reduced CODDTest skips by disabling disallowed features during builds, added GroundTruth join fallback on missing join pairs, and relaxed EET ORDER BY skips without LIMIT (2026-02-06).
- Reviewed logs/reports; EET cases show schema column missing errors, CODDTest mostly skips on aggregate/join/predicate/type, GroundTruth key_missing dominates, EET skips on ORDER BY constraints, and non-EET error reasons lack detail (2026-02-06).
- Added QuerySpec and expanded SelectQueryBuilder constraints to move oracle guardrails into build-time checks (2026-02-06).
- Added QueryAnalysis and wired oracle query helpers to reuse generator analysis (2026-02-06).
- Reduced EET oracle weight in config from 5 to 4 (2026-02-06).
- Added LRU cache tests and a test for cached parse-error results for subquery detection (2026-02-06).
- Added LRU cache for subquery feature detection parsing (2026-02-06).
- Refined subquery fast-path normalization and tests (2026-02-06).
- Added SQL keyword fast-path before subquery feature parsing (2026-02-05).
- Defined shared core-oracle list for summary logging (2026-02-05).
- Logged per-oracle skip/effective ratios in interval stats (2026-02-05).
- Adjusted parser-call counting order and simplified variant parse guard (2026-02-05).
- Logged parser-call counters and effective oracle runs per interval (2026-02-05).
- Removed redundant builder stats reset in runner (2026-02-05).
- Added builder attempt metrics and interval logging for select builder efficiency (2026-02-05).
- Report UI: add optional flaky field to CaseEntry type (2026-02-05).
- Added a detailed fuzz-efficiency refactor plan to TODO and synced follow-ups (2026-02-05).
- EET: reuse details map for error cases and switch date identity to DATE_ADD (2026-02-05).
- Renamed abbrevSQL parameter to avoid predeclared identifier lint (2026-02-05).
- Fixed minimize replay compile error from reusing := with existing err (2026-02-05).
- Documented the report index/on-demand loading plan in TODO and follow-ups (2026-02-05).
- Added minimize replay tracing to log last SQL/err on connection close warnings; classified runtime query errors as bugs (2026-02-05).
- CODDTest: allow empty-column predicates to run independent path before type guard (2026-02-05).
- Named return values in `eetSignatureErrorDetails` to satisfy revive lint (2026-02-05).
- Reviewed refactor candidates and synced TODO/follow-ups (join predicate strategies, GroundTruth JoinEdge wiring, oracle override profiles) (2026-02-05).
- Reviewed .paper/paper docs and added refactor candidates (adaptive capability model, shared plan parsing, KQE-lite, unified rewrite registry, type-compat refinement) to TODO/follow-ups (2026-02-05).
- Added a constraints-based SelectQueryBuilder, tightened DSG join alignment, and improved GroundTruth/CERT generation guardrails (2026-01-30).
- Fixed JOIN ON scope validation, added CERT scope checks, and updated tests (2026-01-30).
- TLP: added error_reason/whitelist skips, fixed UNION/ORDER BY 1221, rewrote USING to ON with column qualification, removed unused helpers, and updated tests/logging (2026-01-30).
- CERT sampling: removed weight config, fixed sampling at a constant rate, added sampling ratio logs, and refined bandit/lock handling with safe fallbacks (2026-01-30).
- DQP: treat LEADING mismatches as TiDB bugs (2026-01-30).
- EXISTS metrics: regex matching for whitespace/newlines; TODO to improve EXISTS/NOT EXISTS coverage (2026-01-30).
- Reviewed logs/reports, captured CERT/TLP/DQP examples, and fixed PR description line breaks (2026-01-30).
- Ran `go test ./...` (2026-01-29, 2026-01-30).
- Added paper notes: EET and SQLancer++ summaries under docs (2026-01-30).
- Added the EET oracle using AST-level predicate rewrites and signature comparison (2026-01-30).
- Expanded EET to cover HAVING/JOIN ON and added type-aware literal identities (2026-01-30).
- Added weighted EET rewrite selection to tune boolean vs literal identities (2026-01-30).
- Added TODO to track EET rewrite coverage logging needs (2026-01-30).
- Addressed EET review fixes (date rewrite form, parser driver imports, predicate target shuffle, doc TODO updates) (2026-01-30).
- Loosened EET predicate guards (allow NOT/IS NULL) and raised DML/EXISTS subquery probabilities (2026-01-31).
- Report UI formatting updates moved to docs/notes/summary.md (2026-01-31).
- Web linting notes moved to docs/notes/feature.md (2026-01-31).
- CI linting updates are tracked in docs/notes/feature.md (2026-01-31).
- Generator randomness updates are tracked in docs/notes/feature.md (2026-01-31).
- TQS randomValue date/time randomness updates are tracked in docs/notes/feature.md (2026-01-31).
- Date sample reuse for predicate equality is tracked in docs/notes/feature.md (2026-01-31).
- Subquery coverage logging and disallow-reason stats are tracked in docs/notes/feature.md (2026-02-01).
- EET skips constant ORDER BY with LIMIT to avoid nondeterministic sampling (2026-02-01).
- Enabled subqueries for non-DQP/TLP oracles via runner overrides (2026-02-01).
- Enabled NOT EXISTS/NOT IN for non-DQP/TLP oracles via runner overrides (2026-02-01).
- Relaxed EET/CODDTest builder subquery constraints and raised PredicateExistsProb to 90 (2026-02-01).
- Added per-oracle subquery coverage logs to avoid DQP/TLP override confusion (2026-02-01).
- Raised PredicateSubqueryScale/PredicateExistsProb and allowed EET predicate subqueries (2026-02-01).
- Added IN(subquery)/NOT IN(subquery) counters to interval logs (2026-02-01).
- Added flaky tag for cases with matching EXPLAIN plans but signature mismatches (2026-02-01).
- Added optional GROUP BY ordinals (GROUP BY 1,2) using ordinal wrappers; sampling is controlled by the feature bandit (2026-02-01).
- Added GroupByOrdinalExpr build tests and stricter invalid-state guard (2026-02-01).
- Switched EXISTS/NOT EXISTS and IN(list) counters to AST parsing for generator and plan-cache SQL (2026-02-02).
- Treated NOT (IN(subquery)) as NOT IN in SQL AST parsing and extended EET USING-qualified guard to CTEs (2026-02-02).
- Split generator SQL feature counts into a dedicated interval log line to keep plan-cache ratios consistent (2026-02-02).
- Switched IN(subquery) counters to generator AST features, added oracle-variant AST counting, and skipped EET USING-qualified column cases (2026-02-02).
- Ensured scalar subquery disallow flags are respected in predicate generation and template predicates (2026-02-03).
- EET now rewrites USING to ON before guards and accepts any predicate target that matches the policy (2026-02-03).
- QPG seen SQL stats now use a monotonic added counter to avoid negative deltas (2026-02-03).
- GroundTruth join key extraction now handles USING/AND and unqualified columns; added tests (2026-02-03).
- GroundTruth now falls back to AST parsing for join keys (alias-aware) to reduce key_missing (2026-02-03).
- GroundTruth now supports composite join keys in truth evaluation and SQL joins (2026-02-03).
- GroundTruth key_missing now logs per-reason breakdown in oracle_skip_reasons (2026-02-03).
- Report UI: added summary aggregation panel and truncation pills for expected/actual rows (2026-02-05).
- CODDTest: treat predicates without column dependencies as valid for no-null guard (2026-02-05).
- EET: classify signature errors as TiDB bugs for missing schema/plan references (2026-02-05).
- GroundTruth: force USING join preference under oracle override to reduce complex join shapes (2026-02-05).
- Enabled subqueries for DQP/TLP via oracle overrides (2026-02-03).
- GroundTruth join key extraction now accepts NOT NOT and NULL-safe equality for ON clauses (2026-02-03).
- Added join_on_policy/join_using_prob config knobs and GroundTruth bias toward USING; key-missing now distinguishes no-column ON predicates (2026-02-03).
- Forced TLP to use complex JOIN ON while keeping GroundTruth simple (2026-02-03).
- Join ON now falls back to USING-derived equality before emitting constant false predicates (2026-02-03).
- Added joinConditionFromUsing fallback test for USING-derived ON equality (2026-02-03).
- Plan cache now treats unknown column errors in WHERE as whitelisted (2026-02-03).
- Simplified join predicate unwrap to satisfy revive lint (2026-02-03).
- Added generator window feature counters in interval logs and split DQP window skip reasons (2026-02-03).
- EET now classifies signature missing-column errors separately for clearer reporting (2026-02-04).
- GroupBy generation now emits at least two columns when available to avoid single-key instability (2026-02-04).
- EET now skips ORDER BY with constants or fewer than two distinct columns (2026-02-04).
- Generator ORDER BY now enforces at least two distinct columns when available (2026-02-04).
- Generator ORDER BY now prefers stable distinct columns and falls back to ordinals (2026-02-04).
- Report summaries now include limited result-set snapshots instead of checksum strings (2026-02-04).
- GroundTruth retries query generation when join ON has no columns to reduce key_missing noise (2026-02-04).
- Metrics log now includes predicate join pair counts alongside the ratio (2026-02-04).
- Lowered view selection probabilities to reduce view frequency (2026-02-04).
- CERT now uses column-only select lists to avoid ONLY_FULL_GROUP_BY and DISTINCT/ORDER BY instability (2026-02-04).
- DQP/TLP predicate guards now allow NOT/IS NULL to reduce skip rate without changing core semantics (2026-02-04).
- Added mismatch/explain-same and GroundTruth skip counters to interval metrics (2026-02-04).
- DSG wide_rows now respects GroundTruth row caps to reduce table_rows_exceeded skips (2026-02-04).
- Added `weights.features.cte_count_max` to cap CTE generation for resource-sensitive runs (2026-02-04).
- CODDTest now supports multi-table dependent mappings with join-aware column binding (2026-02-04).
- DQE now retries predicate generation to bias EXISTS/NOT EXISTS coverage (2026-02-05).
- EET now records per-rewrite skip reasons for coverage accounting (2026-02-05).
- EET now supports type-aware column identity rewrites using schema-based inference (2026-02-05).
- Shared ORDER BY ordinal parsing helpers between generator tests and EET (2026-02-04).
- Report row sampling now detects truncation via LIMIT maxRows+1 and documents SQL safety (2026-02-04).
- SelectQueryBuilder now avoids full feature analysis for join-only constraints and reuses cached determinism checks when available (2026-02-08).
